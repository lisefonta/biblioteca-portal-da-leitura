<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Portal da Leitura</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <h1 class="text-center mb-4">ðŸ“– Portal da Leitura</h1>

        <!-- Cadastro -->
        <div class="card mb-4 shadow">
            <div class="card-body">
                <h4 class="card-title">Cadastrar Livro</h4>
                <div class="row g-2">
                    <div class="col-md-6">
                        <input type="text" id="titulo" class="form-control" placeholder="TÃ­tulo">
                    </div>
                    <div class="col-md-6">
                        <input type="text" id="autor" class="form-control" placeholder="Autor">
                    </div>
                </div>
                <button class="btn btn-primary mt-3 w-100" onclick="cadastrar()">Cadastrar</button>
            </div>
        </div>

        <!-- Lista -->
        <div class="card mb-4 shadow">
            <div class="card-body">
                <h4 class="card-title">Lista de Livros</h4>
                <button class="btn btn-success mb-3" onclick="listar()">ðŸ”„ Atualizar Lista</button>
                <div id="lista" class="list-group"></div>
            </div>
        </div>

        <!-- EmprÃ©stimo e DevoluÃ§Ã£o -->
        <div class="card mb-4 shadow">
            <div class="card-body">
                <h4 class="card-title">EmprÃ©stimo / DevoluÃ§Ã£o</h4>
                <input type="number" id="idLivro" class="form-control mb-2" placeholder="ID do Livro">
                <div class="d-flex gap-2">
                    <button class="btn btn-warning flex-fill" onclick="emprestar()">ðŸ“– Emprestar</button>
                    <button class="btn btn-info flex-fill" onclick="devolver()">âœ… Devolver</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Script -->
    <script>
        const API = "/livros";

        async function cadastrar() {
            const titulo = document.getElementById("titulo").value;
            const autor = document.getElementById("autor").value;

            if (!titulo || !autor) {
                alert("Preencha todos os campos!");
                return;
            }

            const response = await fetch(`${API}/cadastrar?titulo=${encodeURIComponent(titulo)}&autor=${encodeURIComponent(autor)}`, {
                method: "POST"
            });
            const data = await response.json();
            alert("Livro cadastrado: " + data.titulo);
            listar();
        }

        async function listar() {
            const response = await fetch(API);
            const livros = await response.json();
            const listaDiv = document.getElementById("lista");
            listaDiv.innerHTML = "";

            livros.forEach(l => {
                const statusClass = l.emprestado ? "list-group-item-danger" : "list-group-item-success";
                listaDiv.innerHTML += `
                    <div class="list-group-item ${statusClass}">
                        <b>ID:</b> ${l.id} | 
                        <b>TÃ­tulo:</b> ${l.titulo} | 
                        <b>Autor:</b> ${l.autor} | 
                        <b>Status:</b> ${l.emprestado ? "Emprestado" : "DisponÃ­vel"}
                    </div>
                `;
            });
        }

        async function emprestar() {
            const id = document.getElementById("idLivro").value;
            if (!id) { alert("Digite o ID do livro!"); return; }
            const response = await fetch(`${API}/${id}/emprestar`, { method: "POST" });
            const msg = await response.text();
            alert(msg);
            listar();
        }

        async function devolver() {
            const id = document.getElementById("idLivro").value;
            if (!id) { alert("Digite o ID do livro!"); return; }
            const response = await fetch(`${API}/${id}/devolver`, { method: "POST" });
            const msg = await response.text();
            alert(msg);
            listar();
        }

        // Atualiza lista ao carregar a pÃ¡gina
        listar();
    </script>
</body>
</html>
